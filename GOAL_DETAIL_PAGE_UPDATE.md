# Goal Detail Page Update - Real LLM Data Display

## Overview

Updated the `/goals/[id]` page to display **real LLM-generated data** from Firestore instead of mock/placeholder content. The page now shows the actual AI-generated plan summary, insights, and scheduled tasks.

## What Changed

### Before
- Displayed only milestones/objectives from the plan structure
- No plan summary displayed
- No AI insights shown
- No actual calendar tasks (only embedded objective tasks)
- Missing real task scheduling data

### After
- âœ… **AI-Generated Plan Summary** - Full summary from Claude
- âœ… **AI Insights & Recommendations** - Personalized tips and advice
- âœ… **Scheduled Tasks** - Real tasks from `/users/{uid}/tasks/` with dates/times
- âœ… **Plan Structure & Milestones** - Organized phases (renamed section)
- âœ… **Loading States** - Spinner while fetching tasks
- âœ… **Empty States** - Helpful message when no tasks exist

## New Sections Added

### 1. AI-Generated Plan Summary
```tsx
{goal.plan?.taskTemplate?.summary && (
  <div className="bg-white rounded-xl shadow-lg p-8">
    <h2>AI-Generated Plan Summary</h2>
    <p>{goal.plan.taskTemplate.summary}</p>
  </div>
)}
```

**Displays:**
- The motivational summary generated by Claude
- Overview of the approach to achieving the goal
- Context about the plan structure

### 2. AI Insights & Recommendations
```tsx
{goal.plan?.taskTemplate?.insights && (
  <div className="bg-gradient-to-br from-blue-50 to-indigo-50">
    <h2>AI Insights & Recommendations</h2>
    <ul>
      {insights.map(insight => <li>{insight}</li>)}
    </ul>
  </div>
)}
```

**Displays:**
- Actionable insights from Claude
- Personalized recommendations
- Tips for success

### 3. Scheduled Tasks (New!)
```tsx
<div className="bg-white rounded-xl shadow-lg p-8">
  <h2>Scheduled Tasks</h2>
  {tasks.map(task => (
    <div>
      <h3>{task.title}</h3>
      <p>{task.description}</p>
      <span>{task.dueDate}</span>
    </div>
  ))}
</div>
```

**Displays:**
- Real tasks from `/users/{uid}/tasks/` collection
- Task title and description from Claude
- Scheduled date and time
- Completion status with checkbox
- Calendar sync indicator
- Priority indicators (TODAY, OVERDUE, DONE)

## Data Sources

### Goal Data
**API Endpoint:** `GET /api/goals/[id]`

**Returns:**
```typescript
{
  success: true,
  data: {
    specificity: string,
    targetState: string,
    plan: {
      taskTemplate: {
        summary: string,       // â† Used for Plan Summary section
        insights: string[],    // â† Used for AI Insights section
      },
      milestones: Milestone[], // â† Used for Plan Structure section
    },
    ...
  }
}
```

### Tasks Data (New!)
**API Endpoint:** `GET /api/tasks?goalId=[id]`

**Returns:**
```typescript
{
  success: true,
  data: {
    tasks: [
      {
        id: string,
        goalId: string,
        title: string,          // â† From Claude
        description: string,    // â† From Claude
        dueDate: string,        // â† ISO date (startDateTime)
        completed: boolean,
        calendarEventId: string, // â† If synced to Google Calendar
        milestoneId: string,
      }
    ]
  }
}
```

## Task Display Features

### Visual Indicators

**1. Status Badges**
- `TODAY` - Blue badge for tasks due today
- `OVERDUE` - Red badge for past due tasks
- `âœ“ DONE` - Green badge for completed tasks

**2. Color-Coded Cards**
- **Green** - Completed tasks
- **Blue** - Today's tasks (with ring)
- **Red** - Overdue tasks
- **White** - Future tasks

**3. Date/Time Display**
```
ğŸ“… Fri, Nov 1, 2024 â€¢ 9:00 AM
```

**4. Calendar Sync Indicator**
```
ğŸ“† Synced to Calendar
```

### Interactive Elements

**Checkboxes:**
- Click to mark task complete/incomplete
- Calls `handleTaskToggle(taskId, completed)`
- Visual strikethrough when completed

**Hover Effects:**
- Future tasks: Blue border on hover
- All cards: Smooth transitions

## Loading & Empty States

### Loading State
```tsx
{loadingTasks ? (
  <div className="text-center py-8">
    <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    <p className="mt-2 text-gray-600">Loading tasks...</p>
  </div>
) : ...}
```

### Empty State
```tsx
{tasks.length === 0 ? (
  <div className="text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed">
    <span className="text-6xl mb-4 block">ğŸ“</span>
    <p className="text-gray-600 text-lg mb-2">No tasks generated yet</p>
    <p className="text-gray-500 text-sm">
      Tasks will appear here once the AI generates your personalized schedule
    </p>
  </div>
) : ...}
```

## Implementation Details

### State Management
```typescript
const [goal, setGoal] = useState<Goal | null>(null)
const [tasks, setTasks] = useState<Task[]>([])        // â† New
const [loading, setLoading] = useState(true)
const [loadingTasks, setLoadingTasks] = useState(true) // â† New
const [error, setError] = useState<string | null>(null)
```

### Data Fetching
Two separate `useEffect` hooks:
1. **Goal Data** - Fetches from `/api/goals/[id]`
2. **Tasks Data** - Fetches from `/api/tasks?goalId=[id]`

Both run when:
- `goalId` changes
- User is authenticated (`status === 'authenticated'`)

### Task Interface
```typescript
interface Task {
  id: string
  goalId: string
  title: string
  description?: string
  dueDate?: string
  completed: boolean
  calendarEventId?: string
  milestoneId?: string
  createdAt: string
}
```

## Section Order

1. **Header** - Goal title, stats, progress
2. **Plan Summary** - AI-generated overview â† New
3. **AI Insights** - Recommendations â† New
4. **Scheduled Tasks** - Calendar tasks with dates â† New
5. **Plan Structure & Milestones** - Phases and objectives (renamed)
6. **Resources** - Learning materials

## Styling Highlights

### Plan Summary
- Clean white card with shadow
- ğŸ“‹ emoji icon
- Readable typography with `leading-relaxed`
- Preserves whitespace with `whitespace-pre-wrap`

### AI Insights
- Gradient background (blue-50 to indigo-50)
- Border with blue accent
- Bullet points with blue dots
- ğŸ’¡ emoji icon

### Scheduled Tasks
- Responsive cards with hover effects
- Status-based background colors
- Badge indicators for urgency
- Calendar icon for synced tasks
- Completion progress counter

### Milestones
- Renamed to "Plan Structure & Milestones"
- Unchanged functionality
- Clearer labeling of purpose

## User Experience Improvements

### Before
- Users saw only abstract milestones
- No clear action items with dates
- No AI context or reasoning
- Missing the actual schedule

### After
- Users see **why** the plan works (summary + insights)
- Users see **what** to do (scheduled tasks)
- Users see **when** to do it (dates and times)
- Users see **how** it's organized (milestones)
- Clear completion tracking
- Visual urgency indicators

## Testing Checklist

- [x] Page loads without errors
- [x] Plan summary displays correctly
- [x] AI insights render as list
- [x] Tasks fetch from correct API
- [x] Task dates display properly
- [x] Loading spinner shows while fetching
- [x] Empty state shows when no tasks
- [x] Completed tasks show green
- [x] Today's tasks show blue with badge
- [x] Overdue tasks show red with badge
- [x] Calendar sync indicator appears
- [x] Checkboxes are interactive
- [x] Build passes successfully

## Data Flow

```
User visits /goals/[id]
  â†“
1. Fetch goal from /api/goals/[id]
   - Includes plan, milestones, summary, insights
  â†“
2. Fetch tasks from /api/tasks?goalId=[id]
   - Includes scheduled tasks with dates
  â†“
3. Render sections:
   - Plan Summary (from goal.plan.taskTemplate.summary)
   - AI Insights (from goal.plan.taskTemplate.insights)
   - Scheduled Tasks (from tasks array)
   - Milestones (from goal.plan.milestones)
```

## Example Output

### Plan Summary
```
A 12-week progressive running plan that builds your stamina and speed
through consistent training, cross-training, and rest days. You'll
gradually increase your mileage from 3 miles to 13.1 miles.
```

### AI Insights
- Start with a comfortable pace and focus on consistency
- Include cross-training to prevent injuries
- Rest days are crucial for recovery and improvement

### Scheduled Tasks
```
âœ“ DONE
Week 1: Easy run - 3 miles
Start with a comfortable pace. Focus on form and breathing.
ğŸ“… Mon, Oct 28, 2024 â€¢ 7:00 AM
ğŸ“† Synced to Calendar
```

```
TODAY
Week 2: Tempo run - 4 miles
Maintain a steady, challenging pace throughout.
ğŸ“… Fri, Nov 1, 2024 â€¢ 7:00 AM
ğŸ“† Synced to Calendar
```

## No Mock Data

All content is pulled from Firestore:
- âœ… `goal.plan.taskTemplate.summary` - Real AI summary
- âœ… `goal.plan.taskTemplate.insights` - Real AI insights
- âœ… `tasks` from `/api/tasks` - Real scheduled tasks
- âœ… `goal.plan.milestones` - Real plan structure

**No hardcoded/mock data remains!**

## Files Modified

- `app/goals/[id]/page.tsx` - Complete overhaul with new sections

## Status

âœ… **Complete** - Real LLM data now displayed
âœ… **Tested** - Build passes, no errors
âœ… **No Mock Data** - All content from Firestore
âœ… **Enhanced UX** - Much better user experience
ğŸš€ **Ready for Production** - Can be deployed immediately
